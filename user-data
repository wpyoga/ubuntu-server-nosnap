#cloud-config
autoinstall:
  version: 1
  interactive-sections:
  - network
  - apt
  - storage
  #- identity
  identity:
    username: ubuntu
    # generated by: mkpasswd -m sha-512 ubuntu
    password: "$6$6uJDYMlq$hGpFFIKauoOjcoExhp6QJSydFk8qvWzAcUMc9/o4mSZ3ivzM6K5Cu1kyUOhkF.Mp8VYdBqKIKVVe7dB.kF9cv0"
    hostname: ubuntu-server
  ssh:
    install-server: true
  late-commands:
  - chroot /target apt --yes --autoremove purge snapd
  # this base64 is taken from Linux Mint
  - echo UGFja2FnZTogc25hcGQKUGluOiByZWxlYXNlIGE9KgpQaW4tUHJpb3JpdHk6IC0xMAo= | base64 -d | tee /target/etc/apt/preferences.d/nosnap.pref
  # the following commands solve the "Failed unmounting /cdrom." errors when trying to reboot
  # those errors are unrelated to the removal of snapd
  - systemctl disable --now systemd-udevd-control.socket
  - systemctl disable --now systemd-udevd-kernel.socket
  - systemctl disable --now systemd-udevd.service
  - umount /usr/lib/modules
